<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>effective_go</title>


<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}

kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb
}

* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}
</style>


</head>

<body>

<h3 id="toc_0">go基本语法整理</h3>

<p>参见url地址：
<code>https://golang.org/doc/effective_go.html</code></p>

<h5 id="toc_1">1.array与slice区别</h5>

<ul>
<li>array定长，slice变长</li>
<li>array在函数中传参时是副本，slice是引用</li>
</ul>

<h5 id="toc_2">2.new与make</h5>

<ul>
<li>new用于生成一个容器参数type的指针*type，并且initial而且对内部成员做了zero初始化</li>
<li>make只用于slice,map,chan,仅做了initial, 初始值为nil,并且生成的是type而非指针</li>
</ul>

<h5 id="toc_3">3.map数据结构</h5>

<p>map键值组成：key不可以使用slice类型，其他都可以</p>

<div><pre><code class="language-none">Maps are a convenient and powerful built-in data structure that associate
 values of one type (the key) with values of another type (the element or value) 
 The key can be of any type for which the equality operator is defined, such as 
 integers, floating point and complex numbers, strings, pointers, interfaces (as 
 long as the dynamic type supports equality), structs and arrays. Slices cannot 
 be used as map keys, because equality is not defined on them. Like slices, maps
  hold references to an underlying data structure. If you pass a map to a 
  function that changes the contents of the map, the changes will be visible 
  in the caller.
 </code></pre></div>

<ul>
<li>%v的使用</li>
</ul>

<div><pre><code class="language-go">type T struct {
    a int
    b float64
    c string
}
t := &amp;T{ 7, -2.35, &quot;abc\tdef&quot; }
fmt.Printf(&quot;%v\n&quot;, t)
fmt.Printf(&quot;%+v\n&quot;, t)
fmt.Printf(&quot;%#v\n&quot;, t)</code></pre></div>

<p>输出如下：</p>

<div><pre><code class="language-none">&amp;{7 -2.35 abc   def}
&amp;{a:7 b:-2.35 c:abc     def}
&amp;main.T{a:7, b:-2.35, c:&quot;abc\tdef&quot;}</code></pre></div>

<h5 id="toc_4">4.init函数运行：</h5>

<p><code>在所有包的变量进行初始化之后，才开始运行每个包的init函数</code></p>

<h5 id="toc_5">5.接口</h5>

<p>实现接口时，注意调用产生递归，导致死循环</p>

<div><pre><code class="language-php">func (s Sequence) String() string {
    sort.Sort(s)
    //String函数在print中会被调用，所以此处输出需要进行类型强制转换，否则会造成死循环
    return fmt.Sprint([]int(s)）
}</code></pre></div>

<p>But if it turns out that the value does not contain a string, the program will crash with a run-time error. To guard against that, use the &quot;comma, ok&quot; idiom to test, safely, whether the value is a string:</p>

<div><pre><code class="language-php">str, ok := value.(string)
if ok {
    fmt.Printf(&quot;string value is: %q\n&quot;, str)
} else {
    fmt.Printf(&quot;value is not a string\n&quot;)
}</code></pre></div>

<p>If the type assertion fails, str will still exist and be of type string, but it will have the zero value, an empty string.</p>

<h5 id="toc_6">6.注意type的灵活使用：</h5>

<ul>
<li>1.type定义channel</li>
</ul>

<div><pre><code class="language-php">type Chan chan *http.Request

func (ch Chan) ServeHTTP(w http.ResponseWriter, req *http.Request) {
    ch &lt;- req
    fmt.Fprint(w, &quot;notification sent&quot;)
}</code></pre></div>

<ul>
<li>2.type定义函数</li>
</ul>

<div><pre><code class="language-php">// The HandlerFunc type is an adapter to allow the use of
// ordinary functions as HTTP handlers.  If f is a function
// with the appropriate signature, HandlerFunc(f) is a
// Handler object that calls f.
type HandlerFunc func(ResponseWriter, *Request)

// ServeHTTP calls f(w, req).
func (f HandlerFunc) ServeHTTP(w ResponseWriter, req *Request) {
    f(w, req)
}</code></pre></div>

<h5 id="toc_7">7.接口及结构体 嵌套</h5>

<p>接口嵌套的方法调用类似子类继承父类的函数方式，但是不同于子类继承。子类调用，对象就是子类，而接口嵌套调用方法时，其实质是直接调用该方法源（谁的方法，就是调用谁）。</p>

<ul>
<li>使用嵌套函数时，需要注意 <code>指针入参 *struct</code> 与 <code>非指针的入参 struct</code> 的区别 </li>
</ul>

<div><pre><code class="language-c">package main
import &quot;fmt&quot;

//接口
type Parent interface{
    Left
    Right
}
type Left interface {
    getName() string
}
type Right interface{
    getAge() int
}

//结构体嵌套
type User struct {
    N
    A
}

type N string 
type A int

func (n N) getName() string {
    return string(n)
}
func (a A) getAge() int {
    return int(a)
}

func main() {
    var o Parent
    //方式1
    // n := N(&quot;zhang123&quot;)
    // a := A(181)
    //u := User{n,a}
    
    //方式2
    u := new(User)
    u.N = &quot;123&quot;
    u.A = 40
    
    //嵌套结构体实现
    o = u
    fmt.Println(o.getName(), o.getAge())
    //output: &quot;123&quot; 40
}</code></pre></div>

<h5 id="toc_8">8 channel通道使用</h5>

<ul>
<li>示例一个队列通道：</li>
<li>方案1 : （缺点）当存在大量请求时，每一个请求都会新开一个goroutine，虽然会有数量的chan限制，但是仍然会导致服务器大量资源被消耗</li>
</ul>

<div><pre><code class="language-php">方案1
var sem = make(chan int, MaxOutstanding)

func handle(r *Request) {
    sem &lt;- 1    // Wait for active queue to drain.
    process(r)  // May take a long time.
    &lt;-sem       // Done; enable next request to run.
}

func Serve(queue chan *Request) {
    for {
        req := &lt;-queue
        go handle(req)  // Don&#39;t wait for handle to finish.
    }
}</code></pre></div>

<ul>
<li>方案2：修改Serve函数，将channel放在goroutine内外两侧，即可解决方案1的资源消耗问题。但存在bug,匿名函数会调用外部变量，所以会导致多个goroutine 调用同一变量</li>
</ul>

<div><pre><code class="language-none">方案2
func Serve(queue chan *Request) {
    for req := range queue {
        sem &lt;- 1
        go func() {
            process(req) // Buggy; see explanation below.
            &lt;-sem
        }()
    }
}</code></pre></div>

<ul>
<li>方案3：重新定义值，使goroutine不会被调用同一变量</li>
</ul>

<div><pre><code class="language-php">方案3
func Serve(queue chan *Request) {
    for req := range queue {
        req := req // Create new instance of req for the goroutine.
        sem &lt;- 1
        go func() {
            process(req)
            &lt;-sem
        }()
    }
}
</code></pre></div>

<div><pre><code class="language-none">req := req    
it is may odd and write but it&#39;s legal and idiomatic in Go to do this. You get a 
fresh version of the variable with the same name, deliberately shadowing the 
loop variable locally but unique to each goroutine.</code></pre></div>

<h5 id="toc_9">9.匿名函数的另一种理解</h5>

<p>匿名函数可以调用外层变量，在main函数中也是这样</p>

<div><pre><code class="language-none">package main

import (
    &quot;fmt&quot;
)

func main() {
    i := 1

    func () {
        fmt.Println(i) //匿名函数可以调用外层变量
    }()
}

//output:  1</code></pre></div>

<h5 id="toc_10">10.错误处理panic, recover</h5>

<div><pre><code class="language-php">package main

import (
    &quot;fmt&quot;
)

func main() {
    defer func () {//defer
        if err := recover() ; err != nil {//recover函数
            fmt.Println(&quot;in recover&quot;)
            fmt.Println(err.(Err).Error())
        }
    }()
    u := new(User)
    u.Name = &quot;张飞&quot;
    input := 20
    if input &gt; 18 {
        u.error(&quot;超过18岁不可以使用&quot;)
    }
    u.Age = input
    fmt.Println(u)
}

//定义错误,实现Error接口
type Err string

func (e Err) Error() string {
    return string(e)
}

//定义结构体
type User struct {
    Name string
    Age int
}

func (b User) error(mes string) {
    panic(Err(mes))
}
</code></pre></div>




</body>

</html>
